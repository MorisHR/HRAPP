<div class="employee-form-container">
  <mat-card class="form-card">
    <!-- Header -->
    <mat-card-header>
      <div class="header-content">
        <button mat-icon-button routerLink="/tenant/employees" class="back-button">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-text">
          <h1>{{ isEditMode() ? 'Edit Employee' : 'Add New Employee' }}</h1>
          <p class="subtitle">Complete all required fields to register employee</p>
        </div>
      </div>
    </mat-card-header>

    <!-- Progress Bar -->
    <div class="progress-section">
      <div class="progress-header">
        <span class="progress-label">Completion Progress</span>
        <span class="progress-percentage">{{ completionPercentage() }}%</span>
      </div>
      <mat-progress-bar
        mode="determinate"
        [value]="completionPercentage()"
        [color]="completionPercentage() === 100 ? 'primary' : 'accent'">
      </mat-progress-bar>
      <div class="save-status">
        <mat-icon [class.saving]="saving()">
          {{ saving() ? 'cloud_upload' : 'cloud_done' }}
        </mat-icon>
        <span>{{ getSaveStatusText() }}</span>
      </div>
    </div>

    <!-- Error Message -->
    @if (error()) {
      <div class="error-banner">
        <mat-icon>error</mat-icon>
        <span>{{ error() }}</span>
      </div>
    }

    <mat-card-content>
      <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
        <mat-accordion multi>

          <!-- ========== SECTION 1: PERSONAL INFORMATION ========== -->
          <mat-expansion-panel [expanded]="personalInfoExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>person</mat-icon>
                Personal Information
              </mat-panel-title>
              <mat-panel-description>
                Basic employee details
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>First Name *</mat-label>
                <input matInput formControlName="firstName" placeholder="John">
                @if (employeeForm.get('firstName')?.hasError('required')) {
                  <mat-error>
                    First name is required
                  </mat-error>
                }
                @if (employeeForm.get('firstName')?.hasError('minlength')) {
                  <mat-error>
                    Must be at least 2 characters
                  </mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Last Name *</mat-label>
                <input matInput formControlName="lastName" placeholder="Doe">
                @if (employeeForm.get('lastName')?.hasError('required')) {
                  <mat-error>
                    Last name is required
                  </mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Date of Birth *</mat-label>
                <input matInput [matDatepicker]="dobPicker" formControlName="dateOfBirth">
                <mat-datepicker-toggle matIconSuffix [for]="dobPicker"></mat-datepicker-toggle>
                <mat-datepicker #dobPicker></mat-datepicker>
                <mat-error>Date of birth is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Gender *</mat-label>
                <mat-select formControlName="gender">
                  <mat-option value="Male">Male</mat-option>
                  <mat-option value="Female">Female</mat-option>
                  <mat-option value="Other">Other</mat-option>
                </mat-select>
                <mat-error>Gender is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Nationality *</mat-label>
                <mat-select formControlName="nationality">
                  <mat-option value="Mauritian">Mauritian</mat-option>
                  <mat-option value="French">French</mat-option>
                  <mat-option value="Indian">Indian</mat-option>
                  <mat-option value="British">British</mat-option>
                  <mat-option value="Other">Other</mat-option>
                </mat-select>
                <mat-error>Nationality is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>National Identity Card (NIC) *</mat-label>
                <input matInput formControlName="nic" placeholder="A1234567890123">
                <mat-hint>Mauritius NIC format</mat-hint>
                <mat-error>NIC is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Phone Number *</mat-label>
                <input matInput formControlName="phoneNumber" placeholder="+230 5123 4567">
                <mat-error>Phone number is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Email Address *</mat-label>
                <input matInput type="email" formControlName="email" placeholder="john.doe@company.mu">
                @if (employeeForm.get('email')?.hasError('required')) {
                  <mat-error>
                    Email is required
                  </mat-error>
                }
                @if (employeeForm.get('email')?.hasError('email')) {
                  <mat-error>
                    Please enter a valid email
                  </mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Alternate Email</mat-label>
                <input matInput type="email" formControlName="alternateEmail">
                <mat-error>Please enter a valid email</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Blood Group</mat-label>
                <mat-select formControlName="bloodGroup">
                  <mat-option value="A+">A+</mat-option>
                  <mat-option value="A-">A-</mat-option>
                  <mat-option value="B+">B+</mat-option>
                  <mat-option value="B-">B-</mat-option>
                  <mat-option value="O+">O+</mat-option>
                  <mat-option value="O-">O-</mat-option>
                  <mat-option value="AB+">AB+</mat-option>
                  <mat-option value="AB-">AB-</mat-option>
                </mat-select>
              </mat-form-field>

              <!-- Mauritius Address Section -->
              <div class="address-section full-width">
                <h4 class="subsection-title">Residential Address (Mauritius)</h4>
                <div class="form-grid">
                  <mat-form-field appearance="outline">
                    <mat-label>District *</mat-label>
                    <mat-select formControlName="district" (selectionChange)="onDistrictChange($event.value)">
                      @if (districts().length === 0) {
                        <mat-option disabled>Loading districts...</mat-option>
                      }
                      @for (district of districts(); track district.id) {
                        <mat-option [value]="district.id">
                          {{ district.districtName }}
                        </mat-option>
                      }
                    </mat-select>
                    <mat-hint>Select district first</mat-hint>
                    <mat-error>District is required</mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>Village/Locality</mat-label>
                    <mat-select formControlName="village">
                      @if (villages().length === 0) {
                        <mat-option disabled>Select district first</mat-option>
                      }
                      @for (village of villages(); track village.id) {
                        <mat-option [value]="village.id">
                          {{ village.villageName }} ({{ village.postalCode }})
                        </mat-option>
                      }
                    </mat-select>
                    <mat-hint>Optional - auto-filled by postal code</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>Postal Code</mat-label>
                    <input matInput formControlName="postalCode" placeholder="11302"
                      (blur)="onPostalCodeBlur(employeeForm.get('postalCode')?.value)">
                    <mat-hint>Enter postal code to auto-fill address</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>City/Town</mat-label>
                    <input matInput formControlName="city" placeholder="Port Louis">
                    <mat-hint>Auto-filled from postal code</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Address Line 1 *</mat-label>
                    <input matInput formControlName="addressLine1" placeholder="House/Building number, Street name">
                    @if (employeeForm.get('addressLine1')?.hasError('required')) {
                      <mat-error>
                        Address line 1 is required
                      </mat-error>
                    }
                    @if (employeeForm.get('addressLine1')?.hasError('minlength')) {
                      <mat-error>
                        Must be at least 10 characters
                      </mat-error>
                    }
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Address Line 2</mat-label>
                    <input matInput formControlName="addressLine2" placeholder="Additional address details (optional)">
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>Region</mat-label>
                    <input matInput formControlName="region" placeholder="e.g., North, South">
                    <mat-hint>Auto-filled from postal code</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline">
                    <mat-label>Country *</mat-label>
                    <mat-select formControlName="country">
                      <mat-option value="Mauritius">Mauritius</mat-option>
                      <mat-option value="Rodrigues">Rodrigues</mat-option>
                      <mat-option value="Agalega">Agalega</mat-option>
                    </mat-select>
                    <mat-error>Country is required</mat-error>
                  </mat-form-field>
                </div>
              </div>

              <!-- Expatriate-specific fields -->
              @if (isExpatriate()) {
                <div class="expatriate-section full-width">
                  <h4 class="subsection-title">Expatriate Documents</h4>
                  <div class="form-grid">
                    <mat-form-field appearance="outline">
                      <mat-label>Passport Number *</mat-label>
                      <input matInput formControlName="passportNumber">
                      <mat-error>Passport number is required for expatriates</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Passport Expiry Date *</mat-label>
                      <input matInput [matDatepicker]="passportPicker" formControlName="passportExpiryDate">
                      <mat-datepicker-toggle matIconSuffix [for]="passportPicker"></mat-datepicker-toggle>
                      <mat-datepicker #passportPicker></mat-datepicker>
                      <mat-error>Passport expiry date is required</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Visa Number *</mat-label>
                      <input matInput formControlName="visaNumber">
                      <mat-error>Visa number is required for expatriates</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Visa Expiry Date</mat-label>
                      <input matInput [matDatepicker]="visaPicker" formControlName="visaExpiryDate">
                      <mat-datepicker-toggle matIconSuffix [for]="visaPicker"></mat-datepicker-toggle>
                      <mat-datepicker #visaPicker></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Work Permit Number *</mat-label>
                      <input matInput formControlName="workPermitNumber">
                      <mat-error>Work permit number is required</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Work Permit Expiry Date</mat-label>
                      <input matInput [matDatepicker]="workPermitPicker" formControlName="workPermitExpiryDate">
                      <mat-datepicker-toggle matIconSuffix [for]="workPermitPicker"></mat-datepicker-toggle>
                      <mat-datepicker #workPermitPicker></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Work Permit Type</mat-label>
                      <mat-select formControlName="workPermitType">
                        <mat-option value="Occupation Permit">Occupation Permit</mat-option>
                        <mat-option value="Residence Permit">Residence Permit</mat-option>
                        <mat-option value="Work Permit">Work Permit</mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Residence Permit Number</mat-label>
                      <input matInput formControlName="residencePermitNumber">
                    </mat-form-field>
                  </div>
                </div>
              }
            </div>
          </mat-expansion-panel>

          <!-- ========== SECTION 2: EMPLOYMENT DETAILS ========== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>work</mat-icon>
                Employment Details
              </mat-panel-title>
              <mat-panel-description>
                Position and department information
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Employee Code *</mat-label>
                <input matInput formControlName="employeeCode" placeholder="EMP001">
                <mat-hint>Unique identifier</mat-hint>
                <mat-error>Employee code is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Employee Type *</mat-label>
                <mat-select formControlName="employeeType">
                  <mat-option value="Local">Local</mat-option>
                  <mat-option value="Expatriate">Expatriate</mat-option>
                </mat-select>
                <mat-error>Employee type is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Department *</mat-label>
                <mat-select formControlName="department">
                  @if (departments().length === 0) {
                    <mat-option disabled>Loading departments...</mat-option>
                  }
                  @for (dept of departments(); track dept.id) {
                    <mat-option [value]="dept.name">
                      {{ dept.name }} ({{ dept.code }})
                    </mat-option>
                  }
                </mat-select>
                <mat-error>Department is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Designation *</mat-label>
                <input matInput formControlName="designation" placeholder="Production Manager">
                <mat-error>Designation is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Industry Sector *</mat-label>
                <mat-select formControlName="industrySector">
                  <mat-option value="Manufacturing">Manufacturing</mat-option>
                  <mat-option value="EPZ">EPZ (Export Processing Zone)</mat-option>
                  <mat-option value="Tourism">Tourism & Hospitality</mat-option>
                  <mat-option value="Financial Services">Financial Services</mat-option>
                  <mat-option value="ICT">ICT & Technology</mat-option>
                  <mat-option value="Construction">Construction</mat-option>
                  <mat-option value="Retail">Retail & Trade</mat-option>
                  <mat-option value="Agriculture">Agriculture & Fishing</mat-option>
                </mat-select>
                <mat-error>Industry sector is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Work Location</mat-label>
                <input matInput formControlName="workLocation" placeholder="Head Office">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Reporting To</mat-label>
                <input matInput formControlName="reportingTo" placeholder="Manager name">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Join Date *</mat-label>
                <input matInput [matDatepicker]="joinPicker" formControlName="joinDate">
                <mat-datepicker-toggle matIconSuffix [for]="joinPicker"></mat-datepicker-toggle>
                <mat-datepicker #joinPicker></mat-datepicker>
                <mat-error>Join date is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Probation Period (Months)</mat-label>
                <input matInput type="number" formControlName="probationPeriodMonths" placeholder="3">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Employment Contract Type *</mat-label>
                <mat-select formControlName="employmentContractType">
                  <mat-option value="Permanent">Permanent</mat-option>
                  <mat-option value="Fixed-Term">Fixed-Term</mat-option>
                  <mat-option value="Casual">Casual</mat-option>
                  <mat-option value="Contract">Contract</mat-option>
                </mat-select>
                <mat-error>Contract type is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Employment Status *</mat-label>
                <mat-select formControlName="employmentStatus">
                  <mat-option value="Active">Active</mat-option>
                  <mat-option value="On Probation">On Probation</mat-option>
                  <mat-option value="On Leave">On Leave</mat-option>
                  <mat-option value="Suspended">Suspended</mat-option>
                  <mat-option value="Terminated">Terminated</mat-option>
                </mat-select>
                <mat-error>Employment status is required</mat-error>
              </mat-form-field>
            </div>
          </mat-expansion-panel>

          <!-- ========== SECTION 3: COMPENSATION & BANKING ========== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>payments</mat-icon>
                Compensation & Banking
              </mat-panel-title>
              <mat-panel-description>
                Salary and allowances
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Base Salary (MUR) *</mat-label>
                <input matInput type="number" formControlName="baseSalary" placeholder="30000">
                <mat-icon matPrefix>currency_rupee</mat-icon>
                <mat-error>Base salary is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Payment Frequency *</mat-label>
                <mat-select formControlName="paymentFrequency">
                  <mat-option value="Monthly">Monthly</mat-option>
                  <mat-option value="Bi-weekly">Bi-weekly</mat-option>
                  <mat-option value="Weekly">Weekly</mat-option>
                  <mat-option value="Daily">Daily</mat-option>
                </mat-select>
                <mat-error>Payment frequency is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Transport Allowance (MUR)</mat-label>
                <input matInput type="number" formControlName="transportAllowance" placeholder="0">
                <mat-icon matPrefix>directions_car</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Housing Allowance (MUR)</mat-label>
                <input matInput type="number" formControlName="housingAllowance" placeholder="0">
                <mat-icon matPrefix>home</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Meal Allowance (MUR)</mat-label>
                <input matInput type="number" formControlName="mealAllowance" placeholder="0">
                <mat-icon matPrefix>restaurant</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Bank Name</mat-label>
                <input matInput formControlName="bankName" placeholder="MCB, SBM, etc.">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Bank Account Number</mat-label>
                <input matInput formControlName="bankAccountNumber">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Bank Branch Code</mat-label>
                <input matInput formControlName="bankBranchCode">
              </mat-form-field>
            </div>
          </mat-expansion-panel>

          <!-- ========== SECTION 4: STATUTORY COMPLIANCE ========== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>verified_user</mat-icon>
                Statutory Compliance (Mauritius)
              </mat-panel-title>
              <mat-panel-description>
                CSG, NSF, Tax, PRGF
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>CSG Number</mat-label>
                <input matInput formControlName="csgNumber" placeholder="Contribution Sociale Générale">
                <mat-hint>Contribution Sociale Générale</mat-hint>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>NSF Number</mat-label>
                <input matInput formControlName="nsfNumber" placeholder="National Savings Fund">
                <mat-hint>National Savings Fund</mat-hint>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Tax ID Number (TAN)</mat-label>
                <input matInput formControlName="taxIdNumber">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>PRGF Number</mat-label>
                <input matInput formControlName="prNumber" placeholder="Portable Retirement Gratuity Fund">
                <mat-hint>Portable Retirement Gratuity Fund</mat-hint>
              </mat-form-field>
            </div>
          </mat-expansion-panel>

          <!-- ========== SECTION 5: LEAVE ENTITLEMENTS ========== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>event_available</mat-icon>
                Leave Entitlements
              </mat-panel-title>
              <mat-panel-description>
                Annual, sick, casual leave
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Annual Leave Days *</mat-label>
                <input matInput type="number" formControlName="annualLeaveDays" placeholder="20">
                <mat-icon matSuffix>event</mat-icon>
                <mat-error>Annual leave days required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Sick Leave Days *</mat-label>
                <input matInput type="number" formControlName="sickLeaveDays" placeholder="15">
                <mat-icon matSuffix>local_hospital</mat-icon>
                <mat-error>Sick leave days required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Casual Leave Days *</mat-label>
                <input matInput type="number" formControlName="casualLeaveDays" placeholder="5">
                <mat-icon matSuffix>calendar_today</mat-icon>
                <mat-error>Casual leave days required</mat-error>
              </mat-form-field>

              <mat-checkbox formControlName="carryForwardAllowed" class="full-width">
                Allow carry forward of unused leave
              </mat-checkbox>
            </div>
          </mat-expansion-panel>

          <!-- ========== SECTION 6: EMERGENCY CONTACT ========== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>contact_phone</mat-icon>
                Emergency Contact
              </mat-panel-title>
              <mat-panel-description>
                Person to contact in emergency
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Contact Name *</mat-label>
                <input matInput formControlName="emergencyContactName">
                <mat-error>Emergency contact name is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Relation *</mat-label>
                <mat-select formControlName="emergencyContactRelation">
                  <mat-option value="Spouse">Spouse</mat-option>
                  <mat-option value="Parent">Parent</mat-option>
                  <mat-option value="Sibling">Sibling</mat-option>
                  <mat-option value="Child">Child</mat-option>
                  <mat-option value="Friend">Friend</mat-option>
                  <mat-option value="Other">Other</mat-option>
                </mat-select>
                <mat-error>Relation is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Contact Phone *</mat-label>
                <input matInput formControlName="emergencyContactPhone">
                <mat-error>Emergency contact phone is required</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Contact Address</mat-label>
                <textarea matInput formControlName="emergencyContactAddress" rows="2"></textarea>
              </mat-form-field>
            </div>
          </mat-expansion-panel>

          <!-- ========== SECTION 7: QUALIFICATIONS & DOCUMENTS ========== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>school</mat-icon>
                Qualifications & Documents
              </mat-panel-title>
              <mat-panel-description>
                Education and file uploads
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Highest Qualification</mat-label>
                <mat-select formControlName="highestQualification">
                  <mat-option value="High School">High School</mat-option>
                  <mat-option value="Diploma">Diploma</mat-option>
                  <mat-option value="Bachelor's Degree">Bachelor's Degree</mat-option>
                  <mat-option value="Master's Degree">Master's Degree</mat-option>
                  <mat-option value="PhD">PhD</mat-option>
                  <mat-option value="Professional Certificate">Professional Certificate</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>University/Institution</mat-label>
                <input matInput formControlName="university">
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Skills</mat-label>
                <textarea matInput formControlName="skills" rows="2"
                placeholder="e.g., Leadership, Communication, Technical skills"></textarea>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Languages</mat-label>
                <input matInput formControlName="languages" placeholder="e.g., English, French, Creole">
              </mat-form-field>

              <div class="document-uploads full-width">
                <h4 class="subsection-title">Document Uploads</h4>
                <p class="info-text">
                  <mat-icon>info</mat-icon>
                  Document upload feature will be implemented with file storage integration
                </p>
              </div>
            </div>
          </mat-expansion-panel>

          <!-- ========== SECTION 8: SALARY COMPONENTS ========== -->
          @if (isEditMode() && employeeId) {
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>account_balance_wallet</mat-icon>
                  Salary Components
                </mat-panel-title>
                <mat-panel-description>
                  Manage allowances and deductions
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="salary-components-section">
                <!-- Loading State -->
                @if (loadingSalaryComponents()) {
                  <div class="loading-state">
                    <mat-spinner diameter="30"></mat-spinner>
                    <p>Loading salary components...</p>
                  </div>
                }
                <!-- Empty State -->
                @if (!loadingSalaryComponents() && employeeSalaryComponents().length === 0) {
                  <div class="empty-state">
                    <mat-icon>inbox</mat-icon>
                    <p>No salary components assigned yet</p>
                    <button mat-raised-button color="primary" (click)="openSalaryComponentsManagement()">
                      <mat-icon>add</mat-icon>
                      Add Components
                    </button>
                  </div>
                }
                <!-- Components List -->
                @if (!loadingSalaryComponents() && employeeSalaryComponents().length > 0) {
                  <div class="components-list">
                    <div class="components-header">
                      <h3>Active Components</h3>
                      <button mat-raised-button color="primary" (click)="openSalaryComponentsManagement()">
                        <mat-icon>settings</mat-icon>
                        Manage All
                      </button>
                    </div>
                    <div class="component-cards">
                      @for (component of employeeSalaryComponents(); track component) {
                        <mat-card class="component-card">
                          <mat-card-content>
                            <div class="component-header">
                              <div class="component-info">
                                <h4>{{ component.componentName }}</h4>
                                <mat-chip [class]="component.componentType === 'Allowance' ? 'chip-allowance' : 'chip-deduction'">
                                  {{ component.componentType }}
                                </mat-chip>
                              </div>
                              <div class="component-amount">
                                {{ formatCurrency(component.amount) }}
                              </div>
                            </div>
                            <div class="component-details">
                              <div class="detail-row">
                                <mat-icon>event</mat-icon>
                                <span>Effective: {{ formatDate(component.effectiveDate) }}</span>
                              </div>
                              @if (component.endDate) {
                                <div class="detail-row">
                                  <mat-icon>event_busy</mat-icon>
                                  <span>End: {{ formatDate(component.endDate) }}</span>
                                </div>
                              }
                              <div class="detail-row">
                                <mat-icon>{{ component.isRecurring ? 'loop' : 'event_note' }}</mat-icon>
                                <span>{{ component.isRecurring ? 'Recurring' : 'One-time' }}</span>
                              </div>
                              @if (component.requiresApproval) {
                                <div class="detail-row">
                                  <mat-icon [class]="component.isApproved ? 'approved' : 'pending'">
                                    {{ component.isApproved ? 'check_circle' : 'schedule' }}
                                  </mat-icon>
                                  <span>{{ component.isApproved ? 'Approved' : 'Pending Approval' }}</span>
                                </div>
                              }
                            </div>
                            @if (component.description) {
                              <div class="component-description">
                                <p>{{ component.description }}</p>
                              </div>
                            }
                          </mat-card-content>
                        </mat-card>
                      }
                    </div>
                    <!-- Summary -->
                    <div class="components-summary">
                      <div class="summary-item allowances">
                        <mat-icon>add_circle</mat-icon>
                        <div>
                          <span class="label">Total Allowances</span>
                          <span class="value">{{ formatCurrency(getTotalAllowances()) }}</span>
                        </div>
                      </div>
                      <div class="summary-item deductions">
                        <mat-icon>remove_circle</mat-icon>
                        <div>
                          <span class="label">Total Deductions</span>
                          <span class="value">{{ formatCurrency(getTotalDeductions()) }}</span>
                        </div>
                      </div>
                      <div class="summary-item net">
                        <mat-icon>account_balance</mat-icon>
                        <div>
                          <span class="label">Net Adjustment</span>
                          <span class="value">{{ formatCurrency(getNetAdjustment()) }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </mat-expansion-panel>
          }

          <!-- ========== SECTION 9: ADDITIONAL INFORMATION ========== -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>notes</mat-icon>
                Additional Information
              </mat-panel-title>
              <mat-panel-description>
                Optional notes and remarks
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="form-grid">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Notes</mat-label>
                <textarea matInput formControlName="notes" rows="5"
                placeholder="Any additional information or remarks about the employee"></textarea>
              </mat-form-field>
            </div>
          </mat-expansion-panel>

        </mat-accordion>

        <!-- Form Actions -->
        <div class="form-actions">
          <button mat-button type="button" (click)="cancel()" [disabled]="loading()">
            <mat-icon>close</mat-icon>
            Cancel
          </button>

          <button mat-stroked-button type="button" (click)="saveDraft()" [disabled]="saving() || loading()">
            <mat-icon>save</mat-icon>
            Save Draft
          </button>

          <button mat-raised-button color="primary" type="submit" [disabled]="loading() || !employeeForm.valid">
            @if (loading()) {
              <mat-spinner diameter="20"></mat-spinner>
            }
            <mat-icon>check_circle</mat-icon>
            {{ isEditMode() ? 'Update Employee' : 'Create Employee' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
