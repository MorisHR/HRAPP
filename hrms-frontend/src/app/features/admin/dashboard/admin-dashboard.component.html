<div class="admin-dashboard">
  <div class="dashboard-content container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <div>
        <h1 class="dashboard-title">Admin Dashboard</h1>
        <p class="dashboard-subtitle">System overview and monitoring</p>
      </div>
      <button app-button variant="outlined" (click)="refresh()" [disabled]="loading()">
        <app-icon name="refresh" [class.spinning]="loading()"></app-icon>
        Refresh
      </button>
    </div>

    <!-- Stats Cards with Trends -->
    @if (loading() && !stats()) {
      <div class="loading-skeleton">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4]"></div>
      </div>
    } @else if (stats(); as dashboardStats) {
      <div class="stats-grid">
        <!-- Total Tenants -->
        <app-card class="stat-card stat-card-tenants" [elevation]="2" [hoverable]="true" padding="large">
          <div class="stat-content">
            <div class="stat-header">
              <span class="stat-label">Total Tenants</span>
              <div class="stat-icon stat-icon-tenants">
                <app-icon name="business"></app-icon>
              </div>
            </div>
            <div class="stat-value-row">
              <h3 class="stat-value">{{ dashboardStats.totalTenants }}</h3>
              @if (dashboardStats.trends.tenantGrowth && dashboardStats.totalTenants > 0) {
                <div class="stat-trend" [class]="'trend-' + dashboardStats.trends.tenantGrowth.direction">
                  <app-icon [name]="getTrendIcon(dashboardStats.trends.tenantGrowth.direction)"></app-icon>
                  <span>{{ dashboardStats.trends.tenantGrowth.percentChange.toFixed(1) }}%</span>
                </div>
              }
            </div>
            <p class="stat-description">Total organizations</p>
          </div>
        </app-card>

        <!-- Active Tenants -->
        <app-card class="stat-card stat-card-active" [elevation]="2" [hoverable]="true" padding="large">
          <div class="stat-content">
            <div class="stat-header">
              <span class="stat-label">Active Tenants</span>
              <div class="stat-icon stat-icon-active">
                <app-icon name="check_circle"></app-icon>
              </div>
            </div>
            <div class="stat-value-row">
              <h3 class="stat-value">{{ dashboardStats.activeTenants }}</h3>
              @if (dashboardStats.trends.activeGrowth && dashboardStats.activeTenants > 0) {
                <div class="stat-trend" [class]="'trend-' + dashboardStats.trends.activeGrowth.direction">
                  <app-icon [name]="getTrendIcon(dashboardStats.trends.activeGrowth.direction)"></app-icon>
                  <span>{{ dashboardStats.trends.activeGrowth.percentChange.toFixed(1) }}%</span>
                </div>
              }
            </div>
            <p class="stat-description">Currently active</p>
          </div>
        </app-card>

        <!-- Total Employees -->
        <app-card class="stat-card stat-card-employees" [elevation]="2" [hoverable]="true" padding="large">
          <div class="stat-content">
            <div class="stat-header">
              <span class="stat-label">Total Employees</span>
              <div class="stat-icon stat-icon-employees">
                <app-icon name="people"></app-icon>
              </div>
            </div>
            <div class="stat-value-row">
              <h3 class="stat-value">{{ formatNumber(dashboardStats.totalEmployees) }}</h3>
              @if (dashboardStats.trends.employeeGrowth && dashboardStats.totalEmployees > 0) {
                <div class="stat-trend" [class]="'trend-' + dashboardStats.trends.employeeGrowth.direction">
                  <app-icon [name]="getTrendIcon(dashboardStats.trends.employeeGrowth.direction)"></app-icon>
                  <span>{{ dashboardStats.trends.employeeGrowth.percentChange.toFixed(1) }}%</span>
                </div>
              }
            </div>
            <p class="stat-description">Across all tenants</p>
          </div>
        </app-card>

        <!-- Monthly Revenue -->
        <app-card class="stat-card stat-card-revenue" [elevation]="2" [hoverable]="true" padding="large">
          <div class="stat-content">
            <div class="stat-header">
              <span class="stat-label">Monthly Revenue</span>
              <div class="stat-icon stat-icon-revenue">
                <app-icon name="payments"></app-icon>
              </div>
            </div>
            <div class="stat-value-row">
              <h3 class="stat-value">{{ formatCurrency(dashboardStats.monthlyRevenue) }}</h3>
              @if (dashboardStats.trends.revenueGrowth && dashboardStats.monthlyRevenue > 0) {
                <div class="stat-trend" [class]="'trend-' + dashboardStats.trends.revenueGrowth.direction">
                  <app-icon [name]="getTrendIcon(dashboardStats.trends.revenueGrowth.direction)"></app-icon>
                  <span>{{ dashboardStats.trends.revenueGrowth.percentChange.toFixed(1) }}%</span>
                </div>
              }
            </div>
            <p class="stat-description">Recurring revenue</p>
          </div>
        </app-card>
      </div>
    }

    <!-- System Health & Critical Alerts Row -->
    <div class="system-status-row">
      <div class="system-health-section">
        <app-system-health></app-system-health>
      </div>
      <div class="critical-alerts-section">
        <app-critical-alerts></app-critical-alerts>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <h2 class="section-title">Analytics & Trends</h2>
      <div class="charts-grid">
        <!-- Tenant Growth Chart -->
        <app-card [elevation]="2" padding="large" class="chart-card">
          <h3 class="chart-title">Tenant Growth (Last 6 Months)</h3>
          @if (tenantGrowthChart(); as chartData) {
            <div class="chart-wrapper">
              <app-line-chart
                [data]="chartData"
                [loading]="chartsLoading"
                [height]="300"
              ></app-line-chart>
            </div>
          }
        </app-card>

        <!-- Revenue Chart -->
        <app-card [elevation]="2" padding="large" class="chart-card">
          <h3 class="chart-title">Revenue Trend (Last 6 Months)</h3>
          @if (revenueChart(); as chartData) {
            <div class="chart-wrapper">
              <app-bar-chart
                [data]="chartData"
                [loading]="chartsLoading"
                [height]="300"
              ></app-bar-chart>
            </div>
          }
        </app-card>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="activity-section">
      <app-recent-activity [limit]="10" [showViewAll]="true"></app-recent-activity>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2 class="section-title">Quick Actions</h2>
      <div class="actions-grid">
        <app-card class="action-card" [elevation]="2" [hoverable]="true" [clickable]="true" padding="large" routerLink="/admin/tenants">
          <div class="icon-wrapper">
            <app-icon name="business_center"></app-icon>
          </div>
          <h3>Manage Tenants</h3>
          <p>View, create, and manage tenant organizations</p>
        </app-card>

        <app-card class="action-card" [elevation]="2" [hoverable]="true" [clickable]="true" padding="large" routerLink="/admin/tenants/new">
          <div class="icon-wrapper">
            <app-icon name="add_business"></app-icon>
          </div>
          <h3>Create Tenant</h3>
          <p>Onboard a new tenant organization</p>
        </app-card>

        <app-card class="action-card" [elevation]="2" [hoverable]="true" [clickable]="true" padding="large" routerLink="/admin/audit-logs">
          <div class="icon-wrapper">
            <app-icon name="history"></app-icon>
          </div>
          <h3>Audit Logs</h3>
          <p>View system-wide audit trail and security events</p>
        </app-card>

        <app-card class="action-card" [elevation]="2" [hoverable]="true" [clickable]="true" padding="large" routerLink="/admin/security-alerts">
          <div class="icon-wrapper">
            <app-icon name="security"></app-icon>
          </div>
          <h3>Security Alerts</h3>
          <p>Real-time threat detection and security monitoring</p>
        </app-card>
      </div>
    </div>
  </div>
</div>
