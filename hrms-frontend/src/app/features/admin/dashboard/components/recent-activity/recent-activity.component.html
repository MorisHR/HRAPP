<app-card [elevation]="2" padding="large" class="recent-activity-card">
  <div class="activity-header">
    <h3>Recent Activity</h3>
    <div class="header-actions">
      <button
        app-icon-button
        (click)="refresh()"
        [disabled]="loading()"
        class="refresh-button"
      >
        <app-icon [name]="loading() ? 'sync' : 'refresh'" [class.spinning]="loading()"></app-icon>
      </button>
      @if (showViewAll) {
        <a app-button variant="text" routerLink="/admin/activity-logs" class="view-all-link">
          View All
          <app-icon name="arrow_forward"></app-icon>
        </a>
      }
    </div>
  </div>

  @if (loading() && activities().length === 0) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading activity...</p>
    </div>
  } @else if (error()) {
    <div class="error-state">
      <app-icon name="error" class="error-icon"></app-icon>
      <p>{{ error() }}</p>
      <button app-button (click)="refresh()">Retry</button>
    </div>
  } @else if (activities().length === 0) {
    <div class="empty-state">
      <app-icon name="history" class="empty-icon"></app-icon>
      <p>No recent activity</p>
    </div>
  } @else {
    <div class="activity-list">
      @for (activity of activities(); track activity.id) {
        <div class="activity-item" [class.severity]="'severity-' + activity.severity">
          <div class="activity-icon-wrapper" [class]="'severity-' + activity.severity">
            <app-icon [name]="getActivityIcon(activity)"></app-icon>
          </div>
          <div class="activity-content">
            <div class="activity-header-row">
              <h4 class="activity-title">{{ activity.title }}</h4>
              <span class="activity-time">{{ getRelativeTime(activity.timestamp) }}</span>
            </div>
            <p class="activity-description">{{ activity.description }}</p>
            @if (activity.tenantName || activity.userName) {
              <div class="activity-meta">
                @if (activity.tenantName) {
                  <span class="meta-item">
                    <app-icon name="business"></app-icon>
                    {{ activity.tenantName }}
                  </span>
                }
                @if (activity.userName) {
                  <span class="meta-item">
                    <app-icon name="person"></app-icon>
                    {{ activity.userName }}
                  </span>
                }
              </div>
            }
          </div>
          <div class="activity-severity-indicator" [class]="'severity-' + activity.severity"></div>
        </div>
      }
    </div>
  }
</app-card>
