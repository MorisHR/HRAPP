<div class="tenant-form-container">
  <div class="toolbar">
    <app-button variant="ghost" size="small" routerLink="/admin/tenants">
      <app-icon name="arrow-left"></app-icon>
    </app-button>
    <span>{{ isEditMode() ? 'Edit Tenant' : 'Create New Tenant' }}</span>
  </div>

  <div class="form-content">
    <form [formGroup]="tenantForm" (ngSubmit)="onSubmit()">

      <!-- Company Information Section -->
      <app-card class="form-section">
        <div class="card-header">
          <h3 class="card-title">
            <app-icon name="building"></app-icon>
            Company Information
          </h3>
        </div>
        <div class="card-content">
          <div class="form-row">
            <app-input
              label="Company Name"
              formControlName="companyName"
              placeholder="e.g., Acme Corporation"
              class="full-width"
              [error]="tenantForm.get('companyName')?.invalid && tenantForm.get('companyName')?.touched ? getErrorMessage('companyName') : ''"
            ></app-input>
          </div>

          <div class="form-row">
            <app-input
              label="Subdomain"
              formControlName="subdomain"
              placeholder="e.g., acme"
              class="full-width"
              hint="Lowercase letters, numbers, and hyphens only. This will be: subdomain.hrms.com"
              [error]="tenantForm.get('subdomain')?.invalid && tenantForm.get('subdomain')?.touched ? getErrorMessage('subdomain') : ''"
            ></app-input>
          </div>

          <div class="form-row">
            <app-input
              label="Contact Email"
              type="email"
              formControlName="contactEmail"
              placeholder="contact@company.com"
              class="half-width"
              [error]="tenantForm.get('contactEmail')?.invalid && tenantForm.get('contactEmail')?.touched ? getErrorMessage('contactEmail') : ''"
            ></app-input>

            <app-input
              label="Contact Phone"
              type="tel"
              formControlName="contactPhone"
              placeholder="+1234567890"
              class="half-width"
              [error]="tenantForm.get('contactPhone')?.invalid && tenantForm.get('contactPhone')?.touched ? getErrorMessage('contactPhone') : ''"
            ></app-input>
          </div>
        </div>
      </app-card>

      <!-- Industry Sector Section (FORTUNE 500 Pattern) -->
      <app-card class="form-section">
        <div class="card-header">
          <h3 class="card-title">
            <app-icon name="briefcase"></app-icon>
            Industry Sector
          </h3>
        </div>
        <div class="card-content">
          <div class="form-row">
            <app-select
              label="Select Industry Sector (Optional)"
              formControlName="sectorId"
              class="full-width"
              hint="Select the primary industry sector for compliance and reporting"
              [options]="sectorOptions()"
            ></app-select>
          </div>
        </div>
      </app-card>

      <!-- Employee Tier & Pricing Section -->
      <app-card class="form-section">
        <div class="card-header">
          <h3 class="card-title">
            <app-icon name="credit-card"></app-icon>
            Subscription Plan
          </h3>
        </div>
        <div class="card-content">
          <div class="form-row">
            <app-select
              label="Select Employee Tier"
              formControlName="employeeTier"
              [required]="true"
              class="full-width"
              [options]="tierOptions()"
              [error]="tenantForm.get('employeeTier')?.invalid && tenantForm.get('employeeTier')?.touched ? 'Please select an employee tier' : ''"
            ></app-select>
          </div>

          <!-- Pricing Summary Card (appears after tier selection) -->
          @if (selectedTier()) {
            <div class="pricing-summary-card">
              <div class="summary-header">
                <app-icon name="receipt"></app-icon>
                <h3>Subscription Summary</h3>
              </div>

              <div class="summary-pricing">
                <div class="price-amount">
                  {{ getTierPrice() }}
                  <span class="price-period">/month</span>
                </div>
                <div class="price-tier">{{ selectedTier()?.name }}</div>
              </div>

              <div class="summary-limits">
                <div class="limit-item">
                  <div class="limit-icon">
                    <app-icon name="group"></app-icon>
                  </div>
                  <div class="limit-text">
                    <span class="limit-label">Maximum Users</span>
                    <span class="limit-value">{{ getTierMaxUsers() }}</span>
                  </div>
                </div>

                <div class="limit-item">
                  <div class="limit-icon">
                    <app-icon name="storage"></app-icon>
                  </div>
                  <div class="limit-text">
                    <span class="limit-label">Storage Limit</span>
                    <span class="limit-value">{{ getTierStorage() }}</span>
                  </div>
                </div>

                <div class="limit-item">
                  <div class="limit-icon">
                    <app-icon name="api"></app-icon>
                  </div>
                  <div class="limit-text">
                    <span class="limit-label">API Calls</span>
                    <span class="limit-value">{{ getTierApiCalls() }}/month</span>
                  </div>
                </div>
              </div>

              <div class="summary-features">
                <h4>All Enterprise Features Included:</h4>
                <ul class="features-list">
                  @for (feature of enterpriseFeatures; track feature) {
                    <li><app-icon name="check_circle"></app-icon> {{ feature }}</li>
                  }
                </ul>
              </div>

              <div class="summary-note">
                <app-icon name="info"></app-icon>
                <span>Need higher limits? You can upgrade anytime or contact us for custom enterprise pricing.</span>
              </div>
            </div>
          }
        </div>
      </app-card>

      <!-- Admin User Section -->
      <app-card class="form-section">
        <div class="card-header">
          <h3 class="card-title">
            <app-icon name="shield"></app-icon>
            Admin User Account
          </h3>
        </div>
        <div class="card-content">
          <div class="form-row">
            <app-input
              label="Admin User Name"
              formControlName="adminUserName"
              placeholder="John Doe"
              class="full-width"
              [error]="tenantForm.get('adminUserName')?.invalid && tenantForm.get('adminUserName')?.touched ? getErrorMessage('adminUserName') : ''"
            ></app-input>
          </div>

          <div class="form-row">
            <app-input
              label="Admin Email"
              type="email"
              formControlName="adminEmail"
              placeholder="admin@company.com"
              class="full-width"
              [error]="tenantForm.get('adminEmail')?.invalid && tenantForm.get('adminEmail')?.touched ? getErrorMessage('adminEmail') : ''"
            ></app-input>
          </div>

          <div class="form-row">
            <app-input
              label="Admin Password"
              type="password"
              formControlName="adminPassword"
              placeholder="Enter secure password"
              class="full-width"
              hint="Minimum 8 characters with uppercase, lowercase, number, and special character"
              [error]="tenantForm.get('adminPassword')?.invalid && tenantForm.get('adminPassword')?.touched ? getErrorMessage('adminPassword') : ''"
            ></app-input>
          </div>
        </div>
      </app-card>

      <!-- Actions -->
      <div class="form-actions">
        <app-button
          variant="ghost"
          type="button"
          (clicked)="onCancel()"
          [disabled]="loading()">
          Cancel
        </app-button>
        @if (loading()) {
          <app-button
            variant="primary"
            type="submit"
            [disabled]="true">
            <app-progress-spinner size="small" color="primary" class="button-spinner"></app-progress-spinner>
            {{ isEditMode() ? 'Updating...' : 'Creating...' }}
          </app-button>
        } @else {
          <app-button
            variant="primary"
            type="submit"
            [disabled]="tenantForm.invalid">
            {{ isEditMode() ? 'Update Tenant' : 'Create Tenant' }}
          </app-button>
        }
      </div>
    </form>
  </div>
</div>
