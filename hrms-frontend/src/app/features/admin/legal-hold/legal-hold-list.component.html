<div class="legal-hold-list">
  <h1>Legal Hold Management</h1>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Active Legal Holds</mat-card-title>
      <button mat-raised-button color="primary" (click)="createLegalHold()">
        <app-icon name="add"></app-icon>
        Create Legal Hold
      </button>
    </mat-card-header>

    <mat-card-content>
      @if (loading) {
        <div class="loading-container">
          <app-progress-spinner size="medium" color="primary"></app-progress-spinner>
        </div>
      }

      @if (!loading) {
        <app-table
          [data]="legalHolds"
          [columns]="columns"
          [loading]="loading"
          [hoverable]="true">

          <!-- Custom template for startDate column -->
          <ng-template appTableColumn="startDate" let-row>
            {{ row.startDate | date:'short' }}
          </ng-template>

          <!-- Custom template for endDate column -->
          <ng-template appTableColumn="endDate" let-row>
            {{ row.endDate ? (row.endDate | date:'short') : 'Indefinite' }}
          </ng-template>

          <!-- Custom template for status column -->
          <ng-template appTableColumn="status" let-row>
            <app-chip [label]="row.status" [color]="getStatusColor(row.status)" />
          </ng-template>

          <!-- Custom template for affectedCount column -->
          <ng-template appTableColumn="affectedCount" let-row>
            {{ row.affectedAuditLogCount }} logs, {{ row.affectedEntityCount }} entities
          </ng-template>

          <!-- Custom template for actions column -->
          <ng-template appTableColumn="actions" let-row>
            <button mat-icon-button (click)="viewDetails(row)" appTooltip="View Details">
              <app-icon name="visibility"></app-icon>
            </button>
            <button mat-icon-button (click)="exportEDiscovery(row)" appTooltip="Export eDiscovery">
              <app-icon name="download"></app-icon>
            </button>
            @if (row.status === 'ACTIVE') {
              <button mat-icon-button (click)="releaseLegalHold(row)"
                appTooltip="Release Hold">
                <app-icon name="lock_open"></app-icon>
              </button>
            }
          </ng-template>
        </app-table>
      }
    </mat-card-content>
  </mat-card>
</div>
