<div class="alert-list-container">
  <div class="page-header">
    <h1>Security Alerts</h1>
    <div class="header-actions">
      <button class="btn btn-outline-secondary" (click)="refresh()" [disabled]="loading">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i> Refresh
      </button>
      <button class="btn btn-outline-primary" (click)="exportToCSV()">
        <i class="fas fa-file-csv"></i> Export CSV
      </button>
      <button class="btn btn-outline-danger" (click)="exportToPDF()">
        <i class="fas fa-file-pdf"></i> Export PDF
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <h3>Filters</h3>
    <div class="filters-grid">
      <!-- Status Filter -->
      <div class="filter-group">
        <label for="statusFilter">Status</label>
        <select id="statusFilter" class="form-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option [ngValue]="undefined">All Statuses</option>
          <option *ngFor="let option of statusOptions" [ngValue]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Severity Filter -->
      <div class="filter-group">
        <label for="severityFilter">Severity</label>
        <select id="severityFilter" class="form-select" [(ngModel)]="selectedSeverity" (change)="applyFilters()">
          <option [ngValue]="undefined">All Severities</option>
          <option *ngFor="let option of severityOptions" [ngValue]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Alert Type Filter -->
      <div class="filter-group">
        <label for="alertTypeFilter">Alert Type</label>
        <select id="alertTypeFilter" class="form-select" [(ngModel)]="selectedAlertType" (change)="applyFilters()">
          <option [ngValue]="undefined">All Types</option>
          <option *ngFor="let option of alertTypeOptions" [ngValue]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Start Date Filter -->
      <div class="filter-group">
        <label for="startDateFilter">Start Date</label>
        <input type="datetime-local" id="startDateFilter" class="form-control"
               [(ngModel)]="startDate" (change)="applyFilters()">
      </div>

      <!-- End Date Filter -->
      <div class="filter-group">
        <label for="endDateFilter">End Date</label>
        <input type="datetime-local" id="endDateFilter" class="form-control"
               [(ngModel)]="endDate" (change)="applyFilters()">
      </div>

      <!-- Page Size -->
      <div class="filter-group">
        <label for="pageSizeFilter">Page Size</label>
        <select id="pageSizeFilter" class="form-select" [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
          <option [ngValue]="10">10</option>
          <option [ngValue]="25">25</option>
          <option [ngValue]="50">50</option>
          <option [ngValue]="100">100</option>
        </select>
      </div>
    </div>

    <div class="filter-actions">
      <button class="btn btn-secondary" (click)="resetFilters()">
        <i class="fas fa-undo"></i> Reset Filters
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading alerts...</p>
  </div>

  <!-- Alerts Table -->
  <div *ngIf="!loading" class="alerts-table-container">
    <div class="results-summary">
      <p>Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ Math.min(currentPage * pageSize, totalCount) }} of {{ totalCount }} alerts</p>
    </div>

    <div *ngIf="alerts.length === 0" class="no-results">
      <i class="fas fa-search"></i>
      <p>No alerts found matching your criteria</p>
    </div>

    <div *ngIf="alerts.length > 0" class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th (click)="sortByColumn('severity')" class="sortable">
              Severity <i class="fas" [ngClass]="getSortIcon('severity')"></i>
            </th>
            <th (click)="sortByColumn('alertType')" class="sortable">
              Type <i class="fas" [ngClass]="getSortIcon('alertType')"></i>
            </th>
            <th (click)="sortByColumn('title')" class="sortable">
              Title <i class="fas" [ngClass]="getSortIcon('title')"></i>
            </th>
            <th (click)="sortByColumn('riskScore')" class="sortable">
              Risk Score <i class="fas" [ngClass]="getSortIcon('riskScore')"></i>
            </th>
            <th (click)="sortByColumn('userEmail')" class="sortable">
              User <i class="fas" [ngClass]="getSortIcon('userEmail')"></i>
            </th>
            <th (click)="sortByColumn('detectedAt')" class="sortable">
              Detected <i class="fas" [ngClass]="getSortIcon('detectedAt')"></i>
            </th>
            <th (click)="sortByColumn('status')" class="sortable">
              Status <i class="fas" [ngClass]="getSortIcon('status')"></i>
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let alert of alerts" (click)="viewAlertDetail(alert.id)" class="clickable-row">
            <td>
              <span class="badge" [ngClass]="'badge-' + getSeverityColor(alert.severity)">
                <i [class]="'fas fa-' + getSeverityIcon(alert.severity)"></i>
                {{ alert.severityName }}
              </span>
            </td>
            <td>
              <span class="alert-type">{{ alert.alertTypeName }}</span>
            </td>
            <td>
              <strong>{{ alert.title }}</strong>
              <br>
              <small class="text-muted">{{ alert.description | slice:0:80 }}{{ alert.description.length > 80 ? '...' : '' }}</small>
            </td>
            <td>
              <span class="badge" [ngClass]="'badge-' + getRiskScoreColor(alert.riskScore)">
                {{ alert.riskScore }}/100
              </span>
              <br>
              <small>{{ getRiskScoreLabel(alert.riskScore) }}</small>
            </td>
            <td>
              <span *ngIf="alert.userEmail">{{ alert.userEmail }}</span>
              <span *ngIf="!alert.userEmail" class="text-muted">N/A</span>
              <br>
              <small class="text-muted" *ngIf="alert.ipAddress">{{ alert.ipAddress }}</small>
            </td>
            <td>
              <span>{{ alert.detectedAt | date:'short' }}</span>
              <br>
              <small class="text-muted">{{ formatTimeAgo(alert.detectedAt) }}</small>
            </td>
            <td>
              <span class="badge" [ngClass]="'badge-' + getStatusColor(alert.status)">
                {{ alert.statusName }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-sm btn-outline-primary"
                        (click)="viewAlertDetail(alert.id); $event.stopPropagation()"
                        title="View Details">
                  <i class="fas fa-eye"></i>
                </button>
                <button *ngIf="alert.status === SecurityAlertStatus.NEW"
                        class="btn btn-sm btn-outline-warning"
                        (click)="acknowledgeAlert(alert.id, $event)"
                        title="Acknowledge">
                  <i class="fas fa-check"></i>
                </button>
                <button *ngIf="alert.status === SecurityAlertStatus.ACKNOWLEDGED"
                        class="btn btn-sm btn-outline-info"
                        (click)="markInProgress(alert.id, $event)"
                        title="Mark In Progress">
                  <i class="fas fa-play"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="alerts.length > 0" class="pagination-container">
      <nav aria-label="Page navigation">
        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="changePage(1)" aria-label="First">
              <i class="fas fa-angle-double-left"></i>
            </a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous">
              <i class="fas fa-angle-left"></i>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
            <a class="page-link" (click)="changePage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next">
              <i class="fas fa-angle-right"></i>
            </a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="changePage(totalPages)" aria-label="Last">
              <i class="fas fa-angle-double-right"></i>
            </a>
          </li>
        </ul>
      </nav>
      <div class="pagination-info">
        Page {{ currentPage }} of {{ totalPages }}
      </div>
    </div>
  </div>
</div>
