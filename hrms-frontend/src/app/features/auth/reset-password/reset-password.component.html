<div class="login-container">
  <div class="login-card">
    <!-- Header -->
    <div class="header">
      <h1 class="title">Reset Your Password</h1>
      <p class="subtitle">Create a new secure password for your account</p>
    </div>

    <!-- Invalid Token Message -->
    @if (invalidToken()) {
      <div class="error-message" role="alert">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span>{{ errorMessage() }}</span>
      </div>

      <div class="back-link-container">
        <a routerLink="/auth/forgot-password" class="back-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
          <span>Request a new reset link</span>
        </a>
      </div>
    } @else {
      <!-- Form Container -->
      <div class="form-container">
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="login-form">
          <!-- New Password Input -->
          <div class="input-group">
            <label for="newPassword" class="input-label">New Password</label>
            <div class="password-wrapper">
              <input
                [type]="hidePassword() ? 'password' : 'text'"
                id="newPassword"
                class="form-input password-input"
                placeholder="Enter your new password"
                formControlName="newPassword"
                [disabled]="loading()"
                autocomplete="new-password"
                required
                />
                <button
                  type="button"
                  class="password-toggle"
                  (click)="togglePasswordVisibility()"
                  >
                  @if (hidePassword()) {
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  }
                  @if (!hidePassword()) {
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                      <line x1="1" y1="1" x2="23" y2="23"></line>
                    </svg>
                  }
                </button>
              </div>
              @if (f['newPassword'].value) {
                <div class="password-strength">
                  <div class="strength-bar" [attr.data-strength]="passwordStrength"></div>
                  <span class="strength-label">
                    @if (passwordStrength === 'weak') { Weak }
                      @if (passwordStrength === 'medium') { Medium }
                        @if (passwordStrength === 'strong') { Strong }
                        </span>
                      </div>
                    }
                  </div>

                  <!-- Confirm Password Input -->
                  <div class="input-group">
                    <label for="confirmPassword" class="input-label">Confirm Password</label>
                    <div class="password-wrapper">
                      <input
                        [type]="hideConfirmPassword() ? 'password' : 'text'"
                        id="confirmPassword"
                        class="form-input password-input"
                        placeholder="Confirm your new password"
                        formControlName="confirmPassword"
                        [disabled]="loading()"
                        autocomplete="new-password"
                        required
                        />
                        <button
                          type="button"
                          class="password-toggle"
                          (click)="toggleConfirmPasswordVisibility()"
                          >
                          @if (hideConfirmPassword()) {
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                              <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                          }
                          @if (!hideConfirmPassword()) {
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                              <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                          }
                        </button>
                      </div>
                      @if (submitted() && form.errors?.['passwordMismatch']) {
                        <div class="field-error">Passwords do not match</div>
                      }
                    </div>

                    <!-- Password Requirements -->
                    <div class="password-requirements">
                      <p class="requirements-title">Password must contain:</p>
                      <ul class="requirements-list">
                        <li [class.met]="passwordRequirements.minLength">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                          </svg>
                          At least 12 characters
                        </li>
                        <li [class.met]="passwordRequirements.hasLowercase">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                          </svg>
                          One lowercase letter
                        </li>
                        <li [class.met]="passwordRequirements.hasUppercase">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                          </svg>
                          One uppercase letter
                        </li>
                        <li [class.met]="passwordRequirements.hasNumber">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                          </svg>
                          One number
                        </li>
                        <li [class.met]="passwordRequirements.hasSpecial">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                          </svg>
                          One special character
                        </li>
                      </ul>
                    </div>

                    <!-- Success Message -->
                    @if (successMessage()) {
                      <div class="success-message" role="alert">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        <span>{{ successMessage() }}</span>
                      </div>
                    }

                    <!-- Error Message -->
                    @if (errorMessage()) {
                      <div class="error-message" role="alert">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <circle cx="12" cy="12" r="10"></circle>
                          <line x1="12" y1="8" x2="12" y2="12"></line>
                          <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <span>{{ errorMessage() }}</span>
                      </div>
                    }

                    <!-- Submit Button - MIGRATED TO CUSTOM UI COMPONENT -->
                    <app-button
                      type="submit"
                      variant="primary"
                      [fullWidth]="true"
                      [disabled]="!isValidForm || loading()"
                      [loading]="loading()"
                      loadingText="Resetting password..."
                    >
                      Reset Password
                    </app-button>
                  </form>

                  <!-- Back Link -->
                  <div class="back-link-container">
                    <a [routerLink]="returnUrl()" class="back-link">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                      </svg>
                      <span>Back to login</span>
                    </a>
                  </div>
                </div>
              }

              <!-- Footer -->
              <div class="login-footer">
                <p class="footer-text">© 2025 MorisHR · Secure Authentication</p>
              </div>
            </div>
          </div>
